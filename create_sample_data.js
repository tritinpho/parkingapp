// Sample Data Generator for Parking Management App
// Run this in the browser console after the app loads to populate with sample data
// 
// Recent changes:
// - Payment method column removed from main table (now only in payment history)
// - Invoice printing shows payment method
// - Simplified customer form (removed payment-related fields)
// - Automatic paid status updates when amount owed reaches zero

function resetDatabase() {
    console.log('üîÑ Resetting database to get latest schema...');
    
    // Clear the existing database from localStorage
    localStorage.removeItem('sqliteDatabase');
    localStorage.removeItem('columnVisibility');
    
    console.log('‚úÖ Database cleared. Please refresh the page to initialize with new schema.');
    console.log('After refresh, run createSampleData() again.');
}

function createSampleData() {
    if (!app || !app.dbManager || !app.dbManager.isInitialized) {
        console.error('App not initialized. Please wait for the app to load completely.');
        return;
    }

    // Check if parkingArea column exists by trying a simple query
    try {
        const testQuery = app.dbManager.db.prepare("SELECT parkingArea FROM rentals LIMIT 1");
        testQuery.free();
    } catch (error) {
        console.error('‚ùå Database schema is outdated. The parkingArea column is missing.');
        console.log('üîß SOLUTION: Run resetDatabase() then refresh the page, then run createSampleData() again.');
        console.log('Type: resetDatabase()');
        return;
    }

    const sampleRentals = [
        {
            owner: "Nguy·ªÖn VƒÉn Minh",
            driverAddress: "123 Nguy·ªÖn Hu·ªá, Qu·∫≠n 1, TP.HCM",
            phoneNumber: "0901234567",
            carModel: "Toyota Camry - M√†u ƒêen",
            plateNumber: "51G-123.45",
            parkingArea: "1",
            dateIn: "2024-01-15",
            dateOut: "2024-12-15",
            price: 3500000,
            monthsPaid: 8,
            monthsPaidDetails: "Th√°ng 1-8/2024",
            amountOwed: 1400000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "Kh√°ch h√†ng VIP, ∆∞u ti√™n ch·ªó ƒë·∫≠u"
        },
        {
            owner: "Tr·∫ßn Th·ªã Lan Anh",
            driverAddress: "456 L√™ L·ª£i, Qu·∫≠n 3, TP.HCM",
            phoneNumber: "0912345678",
            carModel: "Honda Civic - M√†u Tr·∫Øng",
            plateNumber: "51H-456.78",
            parkingArea: "2",
            dateIn: "2024-03-01",
            dateOut: "2025-03-01",
            price: 3000000,
            monthsPaid: 12,
            monthsPaidDetails: "Th√°ng 3/2024 - 2/2025",
            amountOwed: 0,
            paid: true,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "ƒê√£ thanh to√°n ƒë·ªß 1 nƒÉm"
        },
        {
            owner: "L√™ Ho√†ng Vi·ªát",
            driverAddress: "789 ƒêi·ªán Bi√™n Ph·ªß, Qu·∫≠n B√¨nh Th·∫°nh, TP.HCM",
            phoneNumber: "0923456789",
            carModel: "Mazda CX-5 - M√†u X√°m",
            plateNumber: "51F-789.12",
            parkingArea: "3",
            dateIn: "2024-06-01",
            dateOut: "2025-06-01",
            price: 3200000,
            monthsPaid: 4,
            monthsPaidDetails: "Th√°ng 6-9/2024",
            amountOwed: 9600000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "C·∫ßn nh·∫Øc nh·ªü thanh to√°n"
        },
        {
            owner: "Ph·∫°m Th·ªã Mai",
            driverAddress: "321 V√µ VƒÉn T·∫ßn, Qu·∫≠n 1, TP.HCM",
            phoneNumber: "0934567890",
            carModel: "BMW X3 - M√†u ƒêen",
            plateNumber: "51B-321.54",
            parkingArea: "4",
            dateIn: "2024-02-20",
            dateOut: "2025-02-20",
            price: 4500000,
            monthsPaid: 12,
            monthsPaidDetails: "Th√°ng 2/2024 - 1/2025",
            amountOwed: 0,
            paid: true,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "Kh√°ch h√†ng th√¢n thi·∫øt"
        },
        {
            owner: "V√µ Minh Tu·∫•n",
            driverAddress: "654 C√°ch M·∫°ng Th√°ng 8, Qu·∫≠n 10, TP.HCM",
            phoneNumber: "0945678901",
            carModel: "Hyundai Tucson - M√†u B·∫°c",
            plateNumber: "51A-654.87",
            parkingArea: "5",
            dateIn: "2024-08-01",
            dateOut: "2025-08-01",
            price: 2800000,
            monthsPaid: 2,
            monthsPaidDetails: "Th√°ng 8-9/2024",
            amountOwed: 8400000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "M·ªõi k√Ω h·ª£p ƒë·ªìng"
        },
        {
            owner: "ƒê·∫∑ng Th·ªã H·ªìng",
            driverAddress: "987 Pasteur, Qu·∫≠n 1, TP.HCM",
            phoneNumber: "0956789012",
            carModel: "Mercedes C200 - M√†u Tr·∫Øng",
            plateNumber: "51G-987.65",
            parkingArea: "6",
            dateIn: "2023-12-01",
            dateOut: "2024-12-01",
            price: 5000000,
            monthsPaid: 10,
            monthsPaidDetails: "Th√°ng 12/2023 - 9/2024",
            amountOwed: 10000000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "H·∫øt h·∫°n h·ª£p ƒë·ªìng, c·∫ßn gia h·∫°n"
        },
        {
            owner: "Ng√¥ VƒÉn ƒê·ª©c",
            driverAddress: "147 Tr∆∞·ªùng Chinh, Qu·∫≠n T√¢n B√¨nh, TP.HCM",
            phoneNumber: "0967890123",
            carModel: "Ford EcoSport - M√†u ƒê·ªè",
            plateNumber: "51F-147.25",
            parkingArea: "7",
            dateIn: "2024-04-15",
            dateOut: "2025-04-15",
            price: 2500000,
            monthsPaid: 6,
            monthsPaidDetails: "Th√°ng 4-9/2024",
            amountOwed: 5000000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "H·ªçc sinh l√°i xe m·ªõi"
        },
        {
            owner: "B√πi Th·ªã Thanh",
            driverAddress: "258 Ho√†ng VƒÉn Th·ª•, Qu·∫≠n Ph√∫ Nhu·∫≠n, TP.HCM",
            phoneNumber: "0978901234",
            carModel: "Kia Morning - M√†u Xanh",
            plateNumber: "51H-258.96",
            parkingArea: "8",
            dateIn: "2024-07-01",
            dateOut: "2025-07-01",
            price: 2200000,
            monthsPaid: 3,
            monthsPaidDetails: "Th√°ng 7-9/2024",
            amountOwed: 6600000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "Xe nh·ªè, d·ªÖ ƒë·∫≠u"
        },
        {
            owner: "Ho√†ng Minh Kh√¥i",
            driverAddress: "369 Nam K·ª≥ Kh·ªüi Nghƒ©a, Qu·∫≠n 3, TP.HCM",
            phoneNumber: "0989012345",
            carModel: "Lexus RX350 - M√†u B·∫°c",
            plateNumber: "51G-369.14",
            parkingArea: "1",
            dateIn: "2024-05-10",
            dateOut: "2025-05-10",
            price: 6000000,
            monthsPaid: 5,
            monthsPaidDetails: "Th√°ng 5-9/2024",
            amountOwed: 18000000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "Xe sang, c·∫ßn ch·ªó r·ªông"
        },
        {
            owner: "L√Ω Th·ªã Ng·ªçc",
            driverAddress: "741 C·ªông H√≤a, Qu·∫≠n T√¢n B√¨nh, TP.HCM",
            phoneNumber: "0990123456",
            carModel: "Vinfast LUX A2.0 - M√†u ƒêen",
            plateNumber: "51V-741.82",
            parkingArea: "2",
            dateIn: "2024-09-01",
            dateOut: "2025-09-01",
            price: 3800000,
            monthsPaid: 1,
            monthsPaidDetails: "Th√°ng 9/2024",
            amountOwed: 11400000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "Xe Vi·ªát Nam, kh√°ch h√†ng m·ªõi"
        },
        {
            owner: "ƒêinh VƒÉn S∆°n",
            driverAddress: "852 X√¥ Vi·∫øt Ngh·ªá Tƒ©nh, Qu·∫≠n B√¨nh Th·∫°nh, TP.HCM",
            phoneNumber: "0901357924",
            carModel: "Audi Q5 - M√†u Xanh",
            plateNumber: "51A-852.73",
            parkingArea: "3",
            dateIn: "2024-01-01",
            dateOut: "2024-12-31",
            price: 5500000,
            monthsPaid: 12,
            monthsPaidDetails: "Th√°ng 1-12/2024",
            amountOwed: 0,
            paid: true,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "Thanh to√°n ƒë√∫ng h·∫°n, kh√°ch tin c·∫≠y"
        },
        {
            owner: "Phan Th·ªã Thu",
            driverAddress: "963 Nguy·ªÖn Th·ªã Minh Khai, Qu·∫≠n 1, TP.HCM",
            phoneNumber: "0912468135",
            carModel: "Chevrolet Spark - M√†u V√†ng",
            plateNumber: "51C-963.41",
            parkingArea: "4",
            dateIn: "2024-10-01",
            dateOut: "2025-10-01",
            price: 2000000,
            monthsPaid: 0,
            monthsPaidDetails: "",
            amountOwed: 6000000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "M·ªõi v√†o, ch∆∞a thanh to√°n l·∫ßn n√†o"
        },
        {
            owner: "Tr·ªãnh Minh ƒê·∫°t",
            driverAddress: "159 Hai B√† Tr∆∞ng, Qu·∫≠n 1, TP.HCM",
            phoneNumber: "0923579468",
            carModel: "Land Rover Evoque - M√†u Tr·∫Øng",
            plateNumber: "51L-159.62",
            parkingArea: "5",
            dateIn: "2023-06-01",
            dateOut: "2024-06-01",
            price: 7000000,
            monthsPaid: 12,
            monthsPaidDetails: "Th√°ng 6/2023 - 5/2024",
            amountOwed: 35000000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "H·∫øt h·∫°n t·ª´ th√°ng 6/2024, c·∫ßn gia h·∫°n g·∫•p"
        },
        {
            owner: "Cao Th·ªã B√≠ch",
            driverAddress: "357 L√Ω Th∆∞·ªùng Ki·ªát, Qu·∫≠n 10, TP.HCM",
            phoneNumber: "0934680257",
            carModel: "Nissan X-Trail - M√†u Ghi",
            plateNumber: "51N-357.91",
            parkingArea: "6",
            dateIn: "2024-03-15",
            dateOut: "2025-03-15",
            price: 3300000,
            monthsPaid: 7,
            monthsPaidDetails: "Th√°ng 3-9/2024",
            amountOwed: 9900000,
            paid: false,
            paymentMethod: "Chuy·ªÉn kho·∫£n",
            notes: "Thanh to√°n ƒë·ªÅu ƒë·∫∑n"
        },
        {
            owner: "V∆∞∆°ng VƒÉn H·∫£i",
            driverAddress: "468 An D∆∞∆°ng V∆∞∆°ng, Qu·∫≠n 5, TP.HCM",
            phoneNumber: "0945791368",
            carModel: "Suzuki Swift - M√†u ƒê·ªè",
            plateNumber: "51S-468.37",
            parkingArea: "7",
            dateIn: "2024-08-15",
            dateOut: "2025-08-15",
            price: 2300000,
            monthsPaid: 2,
            monthsPaidDetails: "Th√°ng 8-9/2024",
            amountOwed: 4600000,
            paid: false,
            paymentMethod: "Ti·ªÅn m·∫∑t",
            notes: "Sinh vi√™n, th∆∞·ªùng tr·ªÖ h·∫°n"
        }
    ];

    console.log('Starting to create sample data...');
    
    let successCount = 0;
    sampleRentals.forEach((rental, index) => {
        try {
            const result = app.dbManager.addRental(rental);
            if (result) {
                successCount++;
                console.log(`‚úÖ Added rental ${index + 1}: ${rental.owner}`);
            } else {
                console.error(`‚ùå Failed to add rental ${index + 1}: ${rental.owner}`);
            }
        } catch (error) {
            console.error(`‚ùå Error adding rental ${index + 1}: ${rental.owner}`, error);
        }
    });

    // Refresh the app to show new data
    if (successCount > 0) {
        app.refreshData();
        app.applyFilters();
        console.log(`üéâ Successfully created ${successCount}/${sampleRentals.length} sample rentals!`);
        
        // Add some sample payment history
        console.log('üìã Adding sample payment history...');
        createSamplePaymentHistory();
        
        console.log('The table should now display the sample data with payment history.');
    } else {
        console.error('‚ùå No sample data was created. Please check the console for errors.');
    }
}

function createSamplePaymentHistory() {
    // Sample payment records for some customers
    const samplePayments = [
        // Payments for customer ID 1 (Nguy·ªÖn VƒÉn Minh)
        { rentalId: 1, payment_date: '2024-01-15', amount_paid: 3500000, months_covered: 'Th√°ng 1/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: 'Thanh to√°n ƒë·∫ßu k·ª≥' },
        { rentalId: 1, payment_date: '2024-02-15', amount_paid: 3500000, months_covered: 'Th√°ng 2/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: '' },
        { rentalId: 1, payment_date: '2024-05-20', amount_paid: 10500000, months_covered: 'Th√°ng 3-5/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 3 th√°ng' },
        { rentalId: 1, payment_date: '2024-08-15', amount_paid: 10500000, months_covered: 'Th√°ng 6-8/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 3 th√°ng' },
        
        // Payments for customer ID 2 (Tr·∫ßn Th·ªã Lan Anh)
        { rentalId: 2, payment_date: '2024-03-01', amount_paid: 36000000, months_covered: 'Th√°ng 3/2024 - 2/2025', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n c·∫£ nƒÉm' },
        
        // Payments for customer ID 4 (Ph·∫°m Th·ªã Mai)
        { rentalId: 4, payment_date: '2024-02-20', amount_paid: 54000000, months_covered: 'Th√°ng 2/2024 - 1/2025', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 12 th√°ng' },
        
        // Payments for customer ID 6 (ƒê·∫∑ng Th·ªã H·ªìng)
        { rentalId: 6, payment_date: '2023-12-01', amount_paid: 15000000, months_covered: 'Th√°ng 12/2023 - 2/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 3 th√°ng ƒë·∫ßu' },
        { rentalId: 6, payment_date: '2024-03-15', amount_paid: 20000000, months_covered: 'Th√°ng 3-6/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 4 th√°ng' },
        { rentalId: 6, payment_date: '2024-07-10', amount_paid: 15000000, months_covered: 'Th√°ng 7-9/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: 'Thanh to√°n 3 th√°ng' },
        
        // Payments for customer ID 11 (ƒêinh VƒÉn S∆°n)
        { rentalId: 11, payment_date: '2024-01-01', amount_paid: 66000000, months_covered: 'Th√°ng 1-12/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n c·∫£ nƒÉm 2024' },
        
        // Some recent payments for other customers
        { rentalId: 3, payment_date: '2024-06-01', amount_paid: 3200000, months_covered: 'Th√°ng 6/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: '' },
        { rentalId: 3, payment_date: '2024-07-15', amount_paid: 6400000, months_covered: 'Th√°ng 7-8/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 2 th√°ng' },
        { rentalId: 3, payment_date: '2024-09-10', amount_paid: 3200000, months_covered: 'Th√°ng 9/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: '' },
        
        { rentalId: 5, payment_date: '2024-08-01', amount_paid: 2800000, months_covered: 'Th√°ng 8/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: 'Th√°ng ƒë·∫ßu ti√™n' },
        { rentalId: 5, payment_date: '2024-09-05', amount_paid: 2800000, months_covered: 'Th√°ng 9/2024', payment_method: 'Ti·ªÅn m·∫∑t', notes: '' },
        
        { rentalId: 14, payment_date: '2024-03-15', amount_paid: 9900000, months_covered: 'Th√°ng 3-5/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 3 th√°ng ƒë·∫ßu' },
        { rentalId: 14, payment_date: '2024-06-20', amount_paid: 6600000, months_covered: 'Th√°ng 6-7/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 2 th√°ng' },
        { rentalId: 14, payment_date: '2024-08-25', amount_paid: 6600000, months_covered: 'Th√°ng 8-9/2024', payment_method: 'Chuy·ªÉn kho·∫£n', notes: 'Thanh to√°n 2 th√°ng' }
    ];

    let paymentSuccessCount = 0;
    samplePayments.forEach((payment, index) => {
        try {
            const result = app.dbManager.addPaymentRecord(payment.rentalId, {
                payment_date: payment.payment_date,
                amount_paid: payment.amount_paid,
                months_covered: payment.months_covered,
                payment_method: payment.payment_method,
                notes: payment.notes
            });
            
            if (result) {
                paymentSuccessCount++;
            }
        } catch (error) {
            console.error(`‚ùå Error adding payment ${index + 1}:`, error);
        }
    });

    if (paymentSuccessCount > 0) {
        console.log(`‚úÖ Added ${paymentSuccessCount}/${samplePayments.length} payment history records!`);
        console.log('üí° Try clicking "L·ªãch S·ª≠" button on any customer to see their payment history!');
    }
}

// Instructions for use
console.log(`
üöó PARKING APP SAMPLE DATA GENERATOR üöó

If you're getting errors about missing columns:
1. Run: resetDatabase()
2. Refresh the page (F5)
3. Wait for app to load completely
4. Run: createSampleData()

If no errors:
- Just run: createSampleData()

This will create 15 realistic parking contracts with:
‚úÖ Various parking areas (1-8)
‚úÖ Different payment statuses  
‚úÖ Mix of car types (Toyota, BMW, Mercedes, etc.)
‚úÖ Vietnamese names and addresses
‚úÖ Different payment methods
‚úÖ Some overdue contracts for testing reminders
‚úÖ Various contract periods

Commands available:
- resetDatabase() - Clear and reset database
- createSampleData() - Create sample data + payment history

NEW FEATURES: Payment History + Perfect Compact Invoice UX! 
üéØ Click "L·ªãch S·ª≠" button on any customer to see their detailed payment records
üìù Add new payments with automatic invoice printing option
üñ®Ô∏è Reprint/customize invoices for any past payment (click "üñ®Ô∏è In L·∫°i" on each payment)
‚öôÔ∏è Full customization: edit amounts, select months, preview before printing
üí∞ Track exactly when customers paid and for which months
üìã Professional invoices with complete editing control
‚ú® Perfect modal layering - invoice modal appears on top with smooth animations
üñ®Ô∏è Compact UI - everything fits in viewport without scrolling
üì± Sticky print button always visible at bottom
üîß Fixed: Month selection now properly updates "ƒê√£ n·ªôp cho" display
üí≥ NEW: Enhanced Add Payment Modal with Rate Input & Month Selection
üìä Automatic calculation based on selected months and rate
üîÑ Real-time updates of rental data after payment
üìà Tracks paid months and reduces amount owed automatically
‚úÖ Auto-updates paid status when amount owed reaches zero
üîÑ Automatic paid status calculation in both payment and edit forms
üìù Simplified customer form - payment details managed through payment history
üîÑ Automatic rental updates when payments are deleted from history
üìÑ Simplified invoice reprinting - display-only without month selection
`); 